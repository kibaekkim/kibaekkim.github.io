name: Build

on:
  push:
    branches-ignore:
    - master

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Pages
        uses: actions/configure-pages@v5
      - name: Build
        uses: actions/jekyll-build-pages@v1
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
  deploy:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    # - name: Deploy
    #   if: github.ref == 'refs/heads/source'
    #   env:
    #     GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
    #   run: |
    #     set -xo pipefail
    #     git config --local user.email "action@github.com"
    #     git config --local user.name "GitHub Action"
    #     git checkout master
    #     ls -Q | grep -v _site | xargs rm -rf
    #     mv _site/* .
    #     rm -rf _site
    #     rm -rf .jekyll-cache
    #     [[ -n "$(git status --porcelain)" ]] || exit 0
    #     git add .
    #     git commit -m "Build $(git rev-parse source | grep -o '^.\{10\}')"
    #     git push "https://${GITHUB_ACTOR}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git" master